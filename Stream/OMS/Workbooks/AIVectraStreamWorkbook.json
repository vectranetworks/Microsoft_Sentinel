{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "1638b403-97cb-4684-9c61-eccf637bc07e",
                  "cellValue": "setTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Security",
                  "subTarget": "Security",
                  "preText": "Security",
                  "postText": "Security",
                  "style": "link"
                },
                {
                  "id": "7885725f-585c-4f82-8eb4-5510f8309f5e",
                  "cellValue": "setTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Connection",
                  "subTarget": "Connection",
                  "style": "link"
                },
                {
                  "id": "c1b3b22b-18ac-4ef5-91de-bf5f3c5d020e",
                  "cellValue": "setTab",
                  "linkTarget": "parameter",
                  "linkLabel": "DNS",
                  "subTarget": "DNS",
                  "style": "link"
                },
                {
                  "id": "d1761326-b9a1-4acb-9881-8a558892a5e5",
                  "cellValue": "setTab",
                  "linkTarget": "parameter",
                  "linkLabel": "SSL/x509",
                  "subTarget": "SSL",
                  "style": "link"
                },
                {
                  "id": "3623f43d-589f-4b8d-9d4a-b808dd604c0e",
                  "cellValue": "setTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Host",
                  "subTarget": "Host",
                  "style": "link"
                }
              ]
            },
            "name": "Tabs"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# Security",
                    "style": "{setTab}"
                  },
                  "name": "text - 0"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "3a5ed03d-9400-4ee0-ad0e-5ba136247cdc",
                        "version": "KqlParameterItem/1.0",
                        "name": "Timer",
                        "label": "Time Range",
                        "type": 4,
                        "isRequired": true,
                        "value": {
                          "durationMs": 172800000
                        },
                        "typeSettings": {
                          "selectableValues": [
                            {
                              "durationMs": 300000
                            },
                            {
                              "durationMs": 900000
                            },
                            {
                              "durationMs": 1800000
                            },
                            {
                              "durationMs": 3600000
                            },
                            {
                              "durationMs": 14400000
                            },
                            {
                              "durationMs": 43200000
                            },
                            {
                              "durationMs": 86400000
                            },
                            {
                              "durationMs": 172800000
                            },
                            {
                              "durationMs": 259200000
                            },
                            {
                              "durationMs": 604800000
                            },
                            {
                              "durationMs": 1209600000
                            },
                            {
                              "durationMs": 2419200000
                            },
                            {
                              "durationMs": 2592000000
                            },
                            {
                              "durationMs": 5184000000
                            },
                            {
                              "durationMs": 7776000000
                            }
                          ],
                          "allowCustom": true
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "Timerparameter"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "e5a5309c-893a-44f3-aa28-4829f8227ae0",
                        "version": "KqlParameterItem/1.0",
                        "name": "SourceHostname",
                        "label": "Source hostname",
                        "type": 1,
                        "isRequired": true,
                        "value": "*",
                        "timeContext": {
                          "durationMs": 2592000000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "SourceHostname"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "2e59aa6e-5d43-46ac-b2c3-56d3de1d67ca",
                        "version": "KqlParameterItem/1.0",
                        "name": "SourceIP",
                        "label": "Source IP",
                        "type": 1,
                        "isRequired": true,
                        "value": "*",
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "defaultValue": "value::all"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "SourceIP"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "4301ce7b-cdaf-4708-b168-556635325da4",
                        "version": "KqlParameterItem/1.0",
                        "name": "DestinationIP",
                        "label": "Destination IP",
                        "type": 1,
                        "isRequired": true,
                        "value": "*",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "DestinationIP"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<br />"
                  },
                  "name": "text - 27"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_isession\"\r\n        and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\t\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n      and local_orig == \"false\" and id_resp_p == \"3389\" and resp_ip_bytes != \"0\"\r\n|extend resp_hostname_s = iff(isempty(resp_hostname), \"Not Available\", resp_hostname), resp_domain_s = iff(isempty(resp_domain), \"Not Available\", resp_domain)\r\n|summarize count() by (id_resp_h)\r\n|count\r\n",
                    "size": 4,
                    "showAnalytics": true,
                    "timeContextFromParameter": "Timer",
                    "exportedParameters": [
                      {
                        "fieldName": "",
                        "parameterName": "smbData",
                        "defaultValue": "*"
                      },
                      {
                        "parameterName": "line1",
                        "parameterType": 1,
                        "defaultValue": "*"
                      }
                    ],
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "lightBlue",
                              "text": "RDP servers externally accessible"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          },
                          "emptyValCustomText": "0"
                        }
                      },
                      "showBorder": true,
                      "sortCriteriaField": "count",
                      "sortOrderField": 1,
                      "size": "full"
                    }
                  },
                  "customWidth": "25",
                  "name": "RDP servers externally accessible",
                  "styleSettings": {
                    "margin": "0px",
                    "maxWidth": "100"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_isession\"\r\n        and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\t\t and ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and local_orig == \"false\"\r\n        and id_resp_p == \"445\"\r\n        and resp_ip_bytes != 0 \r\n|summarize count() by (id_resp_h)\r\n|count",
                    "size": 4,
                    "showAnalytics": true,
                    "timeContextFromParameter": "Timer",
                    "exportedParameters": [
                      {
                        "parameterName": "smb",
                        "defaultValue": "*"
                      },
                      {
                        "parameterName": "line2",
                        "parameterType": 1,
                        "defaultValue": "*"
                      }
                    ],
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "lightBlue",
                              "text": "SMB servers externally accessible"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": true,
                      "size": "full"
                    }
                  },
                  "customWidth": "25",
                  "name": "SMB servers externally accessible"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_smbmapping\"\r\n        and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n\t\t and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\t\t and ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and version==\"SMBv1\"\r\n|summarize count() by (id_orig_h)\r\n|count",
                    "size": 4,
                    "showAnalytics": true,
                    "timeContextFromParameter": "Timer",
                    "exportedParameters": [
                      {
                        "parameterName": "hostsusingsmbv1",
                        "defaultValue": "*"
                      },
                      {
                        "parameterName": "line",
                        "parameterType": 1,
                        "defaultValue": "*"
                      }
                    ],
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "id_orig_h_s",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "lightBlue",
                              "text": "Hosts using SMBv1"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": true,
                      "size": "full"
                    }
                  },
                  "customWidth": "25",
                  "name": "Hosts using SMBv1"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_httpsessioninfo\"\r\n        and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n\t\tand ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\t\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and (uri contains_cs \"admin\" or uri contains_cs \"login\" or uri contains_cs  \"setup\" or uri  contains_cs  \"update\" or uri contains_cs \"console\")\r\n        and method != \"CONNECT\"\r\n        and host  matches regex \"(?P<host_header>[^ (]+)\"\r\n        and host !endswith_cs \".windowsupdate.com\"\r\n        and local_orig == \"true\"\r\n        and tostring( status_code) contains_cs \"2\"\r\n|summarize count() by (host)\r\n|count",
                    "size": 4,
                    "showAnalytics": true,
                    "timeContextFromParameter": "Timer",
                    "exportedParameters": [
                      {
                        "parameterName": "UnencryptedwebHosts",
                        "parameterType": 1,
                        "defaultValue": "*"
                      },
                      {
                        "parameterName": "line700",
                        "parameterType": 1,
                        "defaultValue": "*"
                      }
                    ],
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "lightBlue",
                              "text": "Unencrypted web administration Hosts"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": true,
                      "size": "full"
                    }
                  },
                  "customWidth": "25",
                  "name": "Unencrypted web administration Hosts"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<hr style=\"border-top: 1.25px dotted red;background-color:#fff;\">"
                  },
                  "conditionalVisibility": {
                    "parameterName": "line1",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "text - 36"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_isession\"\r\n        and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\t\t and ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n      and local_orig == \"false\" and id_resp_p == \"3389\" and resp_ip_bytes != 0\r\n|extend resp_hostname_s = iff(isempty(resp_hostname), \"Not Available\", resp_hostname), resp_domain_s = iff(isempty(resp_domain), \"Not Available\", resp_domain)\r\n|summarize arg_max(TimeGenerated, *) by id_resp_h\r\n|project TimeGenerated, orig_hostname, id_orig_h, resp_hostname_s, id_resp_h, id_resp_p\r\n|order by TimeGenerated desc\r\n",
                    "size": 0,
                    "title": "RDP servers externally accessible DrillDown",
                    "timeContextFromParameter": "Timer",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "smbData",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "RDP servers externally accessible DrillDown",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<hr style=\"border-top: 1.25px dotted red;background-color:#fff;\">"
                  },
                  "conditionalVisibility": {
                    "parameterName": "line2",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "text - 37"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_isession\"\r\n        and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\t\t and ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and local_orig == \"false\"\r\n        and id_resp_p == \"445\"\r\n        and resp_ip_bytes != 0 \r\n|summarize arg_max(TimeGenerated, *) by id_resp_h\r\n|project TimeGenerated, orig_hostname, id_orig_h, resp_hostname, id_resp_h, id_resp_p\r\n|order by TimeGenerated desc\r\n",
                    "size": 0,
                    "title": "SMB servers externally accessible DrillDown",
                    "timeContextFromParameter": "Timer",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "smb",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "SMB servers externally accessible DrillDown",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<hr style=\"border-top: 1.25px dotted red;background-color:#fff;\">"
                  },
                  "conditionalVisibility": {
                    "parameterName": "line",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "text - 35"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_smbmapping\"\r\n        and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n\t\t and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\t\t and ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and version==\"SMBv1\" \r\n|summarize arg_max(TimeGenerated, *) by id_orig_h\r\n|project TimeGenerated, orig_hostname, id_orig_h, resp_hostname, id_resp_h, id_resp_p\r\n|order by TimeGenerated desc\r\n",
                    "size": 0,
                    "title": "Hosts using SMBv1 DrillDown",
                    "timeContextFromParameter": "Timer",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "hostsusingsmbv1",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "Hosts using SMBv1 DrillDown",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<hr style=\"border-top: 1.25px dotted red;background-color:#fff;\">"
                  },
                  "conditionalVisibility": {
                    "parameterName": "line700",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "text - 41"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_httpsessioninfo\"\r\n        and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n\t\tand ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\t\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and (uri contains_cs \"admin\" or uri contains_cs \"login\" or uri contains_cs  \"setup\" or uri  contains_cs  \"update\" or uri contains_cs \"console\")\r\n        and method != \"CONNECT\"\r\n        and host  matches regex \"(?P<host_header>[^ (]+)\"\r\n        and host !endswith_cs \".windowsupdate.com\"\r\n        and local_orig == \"true\"\r\n        and tostring( status_code) contains_cs \"2\"\r\n|summarize arg_max(TimeGenerated, *) by host\r\n|project TimeGenerated, orig_hostname, id_orig_h, resp_hostname, id_resp_h, id_resp_p,host\r\n|order by TimeGenerated desc\r\n",
                    "size": 0,
                    "title": "Unencrypted web administration Hosts DrillDown",
                    "timeContextFromParameter": "Timer",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "UnencryptedwebHosts",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "Unencrypted web administration Hosts DrillDown",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_isession\" \r\n       and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n\t\tand ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\t\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and local_orig ==\"true\"\r\n        and (id_resp_p == 20 or id_resp_p == 21 or id_resp_p ==23)\r\n|summarize count() by (id_orig_h)\r\n|count",
                    "size": 4,
                    "showAnalytics": true,
                    "timeContextFromParameter": "Timer",
                    "exportedParameters": [
                      {
                        "parameterName": "TelnetFTPClients",
                        "defaultValue": "*"
                      },
                      {
                        "parameterName": "line4",
                        "parameterType": 1,
                        "defaultValue": "*"
                      }
                    ],
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "id_orig_h_s",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "lightBlue",
                              "text": "Telnet & FTP Clients"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": true,
                      "size": "full"
                    }
                  },
                  "customWidth": "25",
                  "name": "Telnet & FTP Clients"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_dhcp\"\r\n    and mac startswith_cs \"B8:27:EB:\"\r\n| summarize arg_max(TimeGenerated, *) by mac\r\n| summarize Count=count() by mac\r\n| summarize sum(Count)",
                    "size": 4,
                    "showAnalytics": true,
                    "timeContextFromParameter": "Timer",
                    "exportedParameters": [
                      {
                        "parameterName": "RaspberryDevices",
                        "defaultValue": "*"
                      },
                      {
                        "fieldName": "",
                        "parameterName": "line5",
                        "parameterType": 1,
                        "defaultValue": "*"
                      }
                    ],
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "lightBlue",
                              "text": "Raspberry Devices"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "sum_Count",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      "showBorder": true,
                      "size": "full"
                    }
                  },
                  "customWidth": "25",
                  "name": "Raspberry Devices"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_beacon\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n\tand ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n| summarize count() by (id_orig_h)\r\n|count",
                    "size": 4,
                    "showAnalytics": true,
                    "timeContextFromParameter": "Timer",
                    "exportedParameters": [
                      {
                        "parameterName": "Beaconinghosts",
                        "parameterType": 1,
                        "defaultValue": "*"
                      },
                      {
                        "parameterName": "line800",
                        "parameterType": 1,
                        "defaultValue": "*"
                      }
                    ],
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "id_orig_h_s",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "lightBlue",
                              "text": "Beaconing hosts"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": true,
                      "size": "full"
                    }
                  },
                  "customWidth": "25",
                  "name": "Beaconing hosts"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_isession\" \r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n\tand ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n    and (resp_domain endswith_cs \".box.com\" or resp_domain endswith_cs \".box.net\" or resp_domain endswith_cs \".boxcdn.net\" or resp_domain endswith_cs \".boxcloud.com\" or resp_domain endswith_cs \".boxrelay.com\") \r\n    or (resp_domain endswith_cs \".db.tt\" or resp_domain endswith_cs \".dropbox-dns.com\" or resp_domain endswith_cs \".dropbox.com\" or resp_domain endswith_cs \".dropboxapi.com\") \r\n    or (resp_domain == \"accounts.google.com\" or resp_domain == \"apis.google.com\" or (resp_domain startswith_cs \"clients\" and resp_domain endswith_cs \".google.com\") or resp_domain == \"docs.google.com\" or resp_domain == \"drive.google.com\" or resp_domain == \"gg.google.com\" or resp_domain == \"googledrive.com\" or resp_domain == \"gv1.com\" or (resp_domain startswith_cs \"lh\" and resp_domain endswith_cs \".google.com\")) \r\n    or (resp_domain == \"s.ytimg.com\" or resp_domain == \"script.google.com\" or resp_domain == \"sheets.google.com\" or resp_domain == \"slides.google.com\" or resp_domain == \"takeout.google.com\" or resp_domain == \"talk.google.com\" or resp_domain == \"video.google.com\" or resp_domain endswith_cs \".client-channel.google.com\" or (resp_domain contains_cs \".clients\" and resp_domain endswith_cs \".google.com\") or resp_domain endswith_cs \".docs.google.com\" or resp_domain endswith_cs \".drive.google.com\" or resp_domain endswith_cs \".googleapis.com\" or resp_domain endswith_cs \".googleusercontent.com\" or resp_domain endswith_cs \".gstatic.com\") \r\n    or (resp_domain endswith_cs \".sharepoint.com\" or resp_domain == \"onedrive.live.com\")\r\n| summarize rbytes = sum(todouble(resp_ip_bytes))\r\n| extend MB=rbytes / 1024 / 1024\r\n| extend MBytes=round(MB, 2)\r\n| project MBytes",
                    "size": 4,
                    "showAnalytics": true,
                    "timeContextFromParameter": "Timer",
                    "exportedParameters": [
                      {
                        "parameterName": "Volumeoftraffic",
                        "defaultValue": "*"
                      },
                      {
                        "parameterName": "line6",
                        "parameterType": 1,
                        "defaultValue": "*"
                      }
                    ],
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "lightBlue",
                              "text": "Volume of traffic send to Cloud Storage"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "MBytes",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal"
                          },
                          "emptyValCustomText": "0"
                        }
                      },
                      "showBorder": true,
                      "size": "full"
                    }
                  },
                  "customWidth": "25",
                  "name": "Volume of traffic send to Cloud Storage"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "💡 Click on the above tile to view more details"
                  },
                  "name": "text - 38"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<hr style=\"border-top: 1.25px dotted red;background-color:#fff;\">"
                  },
                  "conditionalVisibility": {
                    "parameterName": "line4",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "text - 39"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_isession\" \r\n        and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n\t\tand ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\t\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and local_orig ==\"true\"\r\n        and (id_resp_p == 20 or id_resp_p == 21 or id_resp_p ==23)\r\n|summarize arg_max(TimeGenerated, *) by id_orig_h\r\n|project TimeGenerated, orig_hostname, id_orig_h, resp_hostname, id_resp_h, id_resp_p\r\n|order by TimeGenerated desc\r\n",
                    "size": 0,
                    "title": "Telnet & FTP Clients DrillDown",
                    "timeContextFromParameter": "Timer",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "id_orig_h",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "id_orig_h",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "TelnetFTPClients",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "Telnet & FTP Clients DrillDown"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<hr style=\"border-top: 1.25px dotted red;background-color:#fff;\">"
                  },
                  "conditionalVisibility": {
                    "parameterName": "line5",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "text - 40"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n|where metadata_type == \"metadata_dhcp\"\r\n        and mac startswith_cs \"B8:27:EB:\"\r\n|summarize arg_max(TimeGenerated, *) by mac\r\n|project TimeGenerated, assigned_ip, orig_hostname, mac\r\n|order by TimeGenerated desc\r\n",
                    "size": 0,
                    "title": "Raspberry Devices DrillDown",
                    "timeContextFromParameter": "Timer",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "RaspberryDevices",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "Raspberry Devices DrillDown"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<hr style=\"border-top: 1.25px dotted red;background-color:#fff;\">"
                  },
                  "conditionalVisibility": {
                    "parameterName": "line800",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "text - 42"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_beacon\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n\tand ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n|summarize arg_max(TimeGenerated, *) by id_orig_h\r\n|project TimeGenerated, orig_hostname, id_orig_h, resp_hostname, id_resp_h, id_resp_p\r\n|order by TimeGenerated desc",
                    "size": 0,
                    "title": "Beaconing hosts DrillDown",
                    "timeContextFromParameter": "Timer",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "Beaconinghosts",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "Beaconing hosts DrillDown",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<hr style=\"border-top: 1.25px dotted red;background-color:#fff;\">"
                  },
                  "conditionalVisibility": {
                    "parameterName": "line6",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "text - 41"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_isession\" \r\n        and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n\t\t and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\t\t and ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and isnotempty(resp_domain)\r\n        and (( resp_domain endswith_cs \".box.com\" or resp_domain endswith_cs \".box.net\"  or resp_domain endswith_cs \".boxcdn.net\"  or resp_domain endswith_cs \".boxcloud.com\"  or resp_domain endswith_cs \".boxrelay.com\" ) \r\n        or(resp_domain endswith_cs \".db.tt\" or resp_domain endswith_cs \".dropbox-dns.com\"   or resp_domain endswith_cs \".dropbox.com\"  or resp_domain endswith_cs \".dropboxapi.com\") \r\n        or (resp_domain == \"accounts.google.com\" or resp_domain == \"apis.google.com\" or \"clients*.google.com\" has resp_domain or resp_domain == \"docs.google.com\" or resp_domain == \"drive.google.com\" or resp_domain == \"gg.google.com\" or resp_domain == \"googledrive.com\" or resp_domain == \"gv1.com\" or (resp_domain startswith_cs \"lh\" and resp_domain endswith_cs \".google.com\")) \r\n        or (resp_domain == \"s.ytimg.com\" or resp_domain == \"script.google.com\" or resp_domain ==\"sheets.google.com\" or resp_domain == \"slides.google.com\" or resp_domain == \"takeout.google.com\" or resp_domain == \"talk.google.com\" or resp_domain == \"video.google.com\" or resp_domain endswith_cs \".client-channel.google.com\" or (resp_domain contains_cs \".clients\"and resp_domain endswith_cs \".google.com\" ) or resp_domain endswith_cs \".docs.google.com\"  or resp_domain endswith_cs \".drive.google.com\" or resp_domain endswith_cs \".googleapis.com\"  or resp_domain endswith_cs \".googleusercontent.com\"   or resp_domain endswith_cs \".gstatic.com\") \r\n        or (resp_domain endswith_cs \".sharepoint.com\"  or resp_domain == \"onedrive.live.com\"))\r\n| extend orig_hostname = iff(isempty(orig_hostname), \"Not Available\", orig_hostname)\r\n|extend orig_ip_mb=todouble(orig_ip_bytes)/1024/1024\r\n|extend MBytes=round(orig_ip_mb,2)\r\n|order by MBytes desc\r\n|project TimeGenerated,uid,id_orig_h,orig_hostname,resp_domain,MBytes\r\n|order by TimeGenerated desc\r\n\r\n",
                    "size": 0,
                    "title": "Volume of traffic send to Cloud DrillDown",
                    "timeContextFromParameter": "Timer",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Volumeoftraffic",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "Volume of traffic send to Cloud DrillDown"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_isession\"\r\n        and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\t\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n      and local_orig == \"false\"\r\n      and id_resp_p ==\"3389\"\r\n      and resp_ip_bytes != \"0\"\r\n| extend resp_hostname = iff(isempty(resp_hostname), \"Not Available\", resp_hostname), resp_domain = iff(isempty(resp_domain), \"Not Available\", resp_domain)\r\n| summarize count() by resp_hostname\r\n| project-rename [\"Internal Host\"] = resp_hostname, [\"Number of connections\"] = count_",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "RDP servers exposed to the internet",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "barchart",
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "alertId_d",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "graphSettings": {
                      "type": 0,
                      "topContent": {
                        "columnMatch": "TenantId",
                        "formatter": 1
                      },
                      "centerContent": {
                        "columnMatch": "alertId_d",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "RDP servers exposed to the internet",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_isession\"\r\n        and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\t\t and ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n      and local_orig == \"false\"\r\n      and id_resp_p ==\"445\"\r\n      and resp_ip_bytes != \"0\"\r\n      and isnotempty(resp_hostname)\r\n| summarize count() by resp_hostname\r\n| project-rename [\"Internal Host\"] = resp_hostname, [\"Number of connections\"] = count_",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "SMB servers exposed to Internet",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "barchart",
                    "sortBy": []
                  },
                  "customWidth": "50",
                  "name": "SMB servers exposed to Internet",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_isession\" \r\n        and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n\t\t and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\t\t and ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and local_resp == \"true\"\r\n        and (id_resp_p ==\"20\" or id_resp_p == \"21\") \r\n        and resp_pkts != \"0\"\r\n| extend resp_hostname = iff(isempty(resp_hostname), \"Not Available\", resp_hostname), orig_hostname = iff(isempty(orig_hostname), \"Not Available\", orig_hostname)\r\n| summarize count() by resp_hostname\r\n| project-rename [\"Internal Host\"] = resp_hostname, [\"Number of connections\"] = count_",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Internal unencrypted FTP Servers",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "barchart"
                  },
                  "customWidth": "50",
                  "name": "Internal unencrypted FTP Servers",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_isession\"\r\n        and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n                and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n                and ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n      and local_resp == \"true\" \r\n          and id_resp_p == \"23\"\r\n          and resp_pkts != \"0\"\r\n| extend resp_hostname = iff(isempty(resp_hostname), \"Not Available\", resp_hostname), orig_hostname = iff(isempty(orig_hostname), \"Not Available\", orig_hostname)\r\n| summarize count() by resp_hostname\r\n| project-rename [\"Internal Host\"] = resp_hostname, [\"Number of connections\"] = count_",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Internal Telnet Servers",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "barchart"
                  },
                  "customWidth": "50",
                  "name": "Internal Telnet Servers",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_isession\" \r\n        and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n\t\tand ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\t\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and (id_resp_p == \"137\" or id_resp_p == \"5535\")\r\n        and protoName == \"UDP\" and resp_pkts != \"0\"\r\n| extend resp_hostname = iff(isempty(resp_hostname), \"Not Available\", resp_hostname), orig_hostname = iff(isempty(orig_hostname), \"Not Available\", orig_hostname)\r\n| summarize count() by resp_hostname\r\n| order by count_ desc\r\n| project-rename [\"Internal Host\"] = resp_hostname, [\"Number of connections\"] = count_",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Host responding to NetBIOS / LLMNR",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "barchart",
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "alertId_d",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "Host responding to NetBIOS / LLMNR",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_httpsessioninfo\" \r\n        and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n\t\tand ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\t\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and (uri contains_cs \"admin\"  or uri contains_cs \"login\" or uri contains_cs \"setup\" or uri contains_cs \"update\" or uri contains_cs \"console\")\r\n        and method != \"CONNECT\"\r\n        and host !endswith_cs \".windowsupdate.com\"\r\n        and local_resp == \"true\"\r\n        and tostring(status_code) startswith_cs \"2\"\r\n| extend resp_hostname = iff(isempty(resp_hostname), \"Not Available\", resp_hostname), orig_hostname = iff(isempty(orig_hostname), \"Not Available\", orig_hostname)\r\n| summarize count() by resp_hostname\r\n| order by count_ desc\r\n| project-rename [\"Internal Host\"] = resp_hostname, [\"Number of connections\"] = count_",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Suspect Internal Unencrypted web administration activities ",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "barchart"
                  },
                  "customWidth": "50",
                  "name": "Suspect Internal Unencrypted web administration activities",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n|where metadata_type == \"metadata_isession\"\r\nand ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\nand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and local_resp==\"true\" and ((id_resp_p ==\"3668\" or id_resp_p ==\"5869\") or (id_resp_p==\"623\" and protoName ==\"UDP\"))\r\n| extend resp_hostname= iff(isempty(resp_hostname), \"Not Available\", resp_hostname), orig_hostname= iff(isempty(orig_hostname), \"Not Available\", orig_hostname)\r\n| summarize count() by resp_hostname\r\n| order by count_ desc\r\n| project-rename [\"Internal Host\"] = resp_hostname, [\"Number of connections\"] = count_\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "IPMI v2 Password Hash Disclosure",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "name": "IPMI v2 Password Hash Disclosure",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type == \"metadata_smbmapping\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n\tand ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n    and version==\"SMBv1\"\r\n| extend resp_hostname = iff(isempty(resp_hostname), \"Not Available\", resp_hostname), orig_hostname = iff(isempty(orig_hostname), \"Not Available\", orig_hostname), username = iff(isempty(username), \"Not Available\", username)\r\n| summarize arg_max(TimeGenerated, *) by id_orig_h, id_resp_h\r\n| project TimeGenerated,uid, id_orig_h, orig_hostname, version, username, id_resp_h, resp_hostname, id_resp_p, service, path\r\n|order by TimeGenerated desc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "SMBv1 (Client and Server tuples)",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TenantId",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "SourceSystem",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 6
                        },
                        {
                          "columnMatch": "alertId_d",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "orange"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    }
                  },
                  "name": "SMBv1 (Client and Server tuples)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_dhcp\"\r\n    and mac startswith_cs \"B8:27:EB:\"\r\n| summarize arg_max(TimeGenerated, *) by mac\r\n| project  TimeGenerated,assigned_ip, orig_hostname, mac\r\n|order by TimeGenerated desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Raspberry Pie Devices",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "filter": true
                    },
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "alertId_d",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "name": "Raspberry Pie Devices",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_beacon\"\r\n         and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n                 and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n                 and ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n| extend resp_domain= iff(isempty(resp_domain), \"Not Available\", resp_domain),orig_hostname= iff(isempty(orig_hostname), \"Not Available\", orig_hostname),resp_hostname= iff(isempty(resp_hostname), \"Not Available\", resp_hostname)\r\n| summarize TOTAL_BEACON = count() by orig_hostname, resp_domains, resp_hostname, id_resp_h, beacon_type, service\r\n|project-rename [\"domains\"]=resp_domains\r\n| project orig_hostname, beacon_type, id_resp_h, [\"domains\"] ,service,TOTAL_BEACON\r\n|order by TOTAL_BEACON desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Beacons table",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TOTAL_BEACON",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    }
                  },
                  "name": "Beacons table",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type == \"metadata_ssl\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n\tand ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n    and isnotempty(server_name) and isnotempty(orig_hostname)\r\n        and (version ==\"TLS1.0\" or version ==\"TLS1.1\" or version startswith_cs \"SSL\")\r\n        or (cipher contains_cs \"3DES\" or cipher contains_cs \"MD5\" or cipher contains_cs \"RC4\" or cipher contains_cs \"anon\" or cipher contains_cs \"CAMELLIA\")\r\n        and local_orig ==\"true\" \r\n        and local_resp==\"false\"\r\n| summarize arg_max(TimeGenerated, *) by server_name, id_orig_h\r\n| project TimeGenerated,uid, id_orig_h, orig_hostname, id_resp_h, id_resp_p,version, server_name,cipher\r\n|order by TimeGenerated desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "TLS 1.0 / 1.1 (weak ciphers)",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true
                    }
                  },
                  "name": "TLS 1.0 / 1.1 (weak ciphers)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type == \"metadata_isession\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n        and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n        and ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and ((resp_domain endswith_cs  \".box.com\" or resp_domain endswith_cs  \".box.net\" or resp_domain endswith_cs  \".boxcdn.net\" or resp_domain endswith_cs \".boxcloud.com\" or resp_domain endswith_cs  \".boxrelay.com\")\r\n        or (resp_domain endswith_cs \".db.tt\" or resp_domain endswith_cs \".dropbox-dns.com\" or resp_domain endswith_cs \".dropbox.com\" or resp_domain endswith_cs \".dropboxapi.com\") \r\n        or (resp_domain ==\"accounts.google.com\" or resp_domain ==\"apis.google.com\" or (resp_domain startswith_cs \"clients\" and resp_domain endswith_cs \".google.com\") or resp_domain ==\"docs.google.com\" or resp_domain ==\"drive.google.com\" or resp_domain ==\"gg.google.com\" or resp_domain ==\"googledrive.com\" or resp_domain ==\"gv1.com\" or (resp_domain startswith_cs \"lh\" and resp_domain endswith_cs \".google.com\")) \r\n        or (resp_domain ==\"s.ytimg.com\" or resp_domain ==\"script.google.com\" or resp_domain ==\"sheets.google.com\" or resp_domain ==\"slides.google.com\" or resp_domain ==\"takeout.google.com\" or resp_domain ==\"talk.google.com\" or resp_domain ==\"video.google.com\" or resp_domain endswith_cs \".client-channel.google.com\" or (resp_domain contains_cs \".clients\" and  resp_domain endswith_cs \".google.com\") or resp_domain endswith_cs \".docs.google.com\" or resp_domain endswith_cs \".drive.google.com\" or resp_domain endswith_cs \".googleapis.com\" or resp_domain endswith_cs \".googleusercontent.com\" or resp_domain endswith_cs \".gstatic.com\") \r\n        or (resp_domain endswith_cs \".sharepoint.com\" or resp_domain ==\"onedrive.live.com\"))\r\n| extend orig_hostname = iff(isempty(orig_hostname), \"Not Available\", orig_hostname)\r\n| extend orig_ip_mb=todouble(orig_ip_bytes)/1024/1024\r\n| extend MBytes=round(orig_ip_mb,2)\r\n| project TimeGenerated,uid,id_orig_h,orig_hostname,resp_domain,MBytes\r\n|order by MBytes,TimeGenerated desc\r\n| limit 200\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Unauthorized cloud storage usage",
                    "timeContextFromParameter": "Timer",
                    "exportParameterName": "ss",
                    "exportDefaultValue": "*",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "MBytes",
                          "formatter": 1
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "alertId_d",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "name": "Unauthorized cloud storage usage",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "📝 Refresh the web page to fetch details of recently collected events"
                  },
                  "name": "text - 42"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "setTab",
              "comparison": "isEqualTo",
              "value": "Security"
            },
            "name": "Security"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# Single Host Analyzer"
                  },
                  "name": "text - 0"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "6c9c6b59-4b3a-4e4d-9aeb-9ecf9f2851a8",
                        "version": "KqlParameterItem/1.0",
                        "name": "TimeRange",
                        "label": "Time Range",
                        "type": 4,
                        "isRequired": true,
                        "value": {
                          "durationMs": 3600000
                        },
                        "typeSettings": {
                          "selectableValues": [
                            {
                              "durationMs": 300000
                            },
                            {
                              "durationMs": 900000
                            },
                            {
                              "durationMs": 1800000
                            },
                            {
                              "durationMs": 3600000
                            },
                            {
                              "durationMs": 14400000
                            },
                            {
                              "durationMs": 43200000
                            },
                            {
                              "durationMs": 86400000
                            },
                            {
                              "durationMs": 172800000
                            },
                            {
                              "durationMs": 259200000
                            },
                            {
                              "durationMs": 604800000
                            },
                            {
                              "durationMs": 1209600000
                            },
                            {
                              "durationMs": 2419200000
                            },
                            {
                              "durationMs": 2592000000
                            },
                            {
                              "durationMs": 5184000000
                            },
                            {
                              "durationMs": 7776000000
                            }
                          ],
                          "allowCustom": true
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "TimeRange"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "23931020-e58b-41b0-9d31-0ac3f3893cb6",
                        "version": "KqlParameterItem/1.0",
                        "name": "HostName",
                        "label": "Source hostname",
                        "type": 1,
                        "isRequired": true,
                        "value": "",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "HostName"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "b2fc3202-65a4-4ab9-93e5-e880107db92d",
                        "version": "KqlParameterItem/1.0",
                        "name": "TimeSpan",
                        "type": 2,
                        "value": "1h",
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "jsonData": "[\r\n    {\"label\": \"1 Hour\", \"value\": \"1h\"},\r\n    {\"label\": \"6 Hour\", \"value\": \"6h\"},\r\n    {\"label\": \"12 Hour\", \"value\": \"12h\"},\r\n    {\"label\": \"1 Day\", \"value\": \"24h\"}\r\n]",
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "label": "Time span"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "TimeSpan"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<br />\r\n\r\n"
                  },
                  "name": "text - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n| where metadata_type==\"metadata_isession\" and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n| summarize count() by id_resp_p\r\n|count",
                    "size": 4,
                    "showAnalytics": true,
                    "timeContextFromParameter": "TimeRange",
                    "exportedParameters": [
                      {
                        "parameterName": "Numberofuniquedestinationports",
                        "defaultValue": "*"
                      },
                      {
                        "parameterName": "line7",
                        "parameterType": 1,
                        "defaultValue": "*"
                      }
                    ],
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "lightBlue",
                              "text": "Number of unique destination ports"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": true,
                      "size": "full"
                    }
                  },
                  "customWidth": "25",
                  "name": "Number of unique destination ports"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n|where metadata_type==\"metadata_isession\" and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\nand local_resp == true\r\n|summarize count()  by id_resp_h\r\n|count",
                    "size": 4,
                    "showAnalytics": true,
                    "timeContextFromParameter": "TimeRange",
                    "exportedParameters": [
                      {
                        "parameterName": "Uniqueinternalhosts",
                        "defaultValue": "*"
                      },
                      {
                        "parameterName": "line8",
                        "parameterType": 1,
                        "defaultValue": "*"
                      }
                    ],
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "lightBlue",
                              "text": "Unique internal hosts"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": true,
                      "size": "full"
                    }
                  },
                  "customWidth": "25",
                  "name": "Unique internal hosts"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type==\"metadata_isession\" and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\nand local_resp == false\r\n|summarize count() by (id_resp_h)\r\n|count",
                    "size": 4,
                    "showAnalytics": true,
                    "timeContextFromParameter": "TimeRange",
                    "exportedParameters": [
                      {
                        "parameterName": "Uniqueexternalhosts",
                        "defaultValue": "*"
                      },
                      {
                        "parameterName": "line9",
                        "parameterType": 1,
                        "defaultValue": "*"
                      }
                    ],
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "lightBlue",
                              "text": "Unique external hosts"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": true,
                      "size": "full"
                    }
                  },
                  "customWidth": "25",
                  "name": "Unique external hosts"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type==\"metadata_beacon\" and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n|summarize count()",
                    "size": 4,
                    "showAnalytics": true,
                    "timeContextFromParameter": "TimeRange",
                    "exportedParameters": [
                      {
                        "parameterName": "TotalBeacons",
                        "parameterType": 1,
                        "defaultValue": "*"
                      },
                      {
                        "parameterName": "lineetb100",
                        "parameterType": 1,
                        "defaultValue": "*"
                      }
                    ],
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "lightBlue",
                              "text": "Total Beacons"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": true,
                      "size": "full"
                    }
                  },
                  "customWidth": "25",
                  "name": "Total Beacons"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "💡 Click on the above tiles to view more details"
                  },
                  "name": "text - 49"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<hr style=\"border-top: 1.25px dotted red;background-color:#fff;\">"
                  },
                  "conditionalVisibility": {
                    "parameterName": "line7",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "text - 46"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type==\"metadata_isession\" and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n|summarize [\"Total sessions\"]=dcount(uid), [\"Number of Hosts\"]=dcount(id_resp_h) by id_resp_p \r\n|order by [\"Total sessions\"] desc\r\n\r\n",
                    "size": 0,
                    "title": "Number of unique destination ports DrillDown",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Numberofuniquedestinationports",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "Number of unique destination ports DrillDown",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<hr style=\"border-top: 1.25px dotted red;background-color:#fff;\">"
                  },
                  "conditionalVisibility": {
                    "parameterName": "line8",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "text - 47"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type==\"metadata_isession\" and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\nand local_resp == true\r\n| extend orig_hostname= iff(isempty(orig_hostname), \"Not Available\", orig_hostname), resp_hostname= iff(isempty(resp_hostname), \"Not Available\", resp_hostname)\r\n| summarize   [\"Total sessions\"]=dcount(uid),[\"Unique destination port\"]= dcount(id_resp_p) by id_resp_h,resp_hostname \r\n|order by [\"Total sessions\"] desc\r\n\r\n",
                    "size": 0,
                    "title": "Unique internal hosts DrillDown",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "Uniqueinternalhosts",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "Unique internal hosts DrillDown",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<hr style=\"border-top: 1.25px dotted red;background-color:#fff;\">"
                  },
                  "conditionalVisibility": {
                    "parameterName": "line9",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "text - 48"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type==\"metadata_isession\" and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\nand local_resp == \"false\" \r\n|summarize [\"Total sessions\"]=dcount(uid), [\"Unique destination port\"]=dcount(id_resp_p) by id_resp_h \r\n|order by [\"Total sessions\"] desc\r\n",
                    "size": 0,
                    "title": "Unique external hosts DrillDown",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "Uniqueexternalhosts",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "Unique external hosts DrillDown",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<hr style=\"border-top: 1.25px dotted red;background-color:#fff;\">"
                  },
                  "conditionalVisibility": {
                    "parameterName": "lineetb100",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "text - 50"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type==\"metadata_beacon\" and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n| extend orig_hostname= iff(isempty(orig_hostname), \"Not Available\", orig_hostname), resp_hostname= iff(isempty(resp_hostname), \"Not Available\", resp_hostname)\r\n| project  TimeGenerated, uid, orig_hostname, id_orig_h, id_resp_h, id_resp_p, beacon_uid\r\n|order by TimeGenerated desc\r\n\r\n",
                    "size": 0,
                    "title": "Total Beacons DrillDown",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "uid",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "uid",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "TotalBeacons",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "Total Beacons DrillDown",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type==\"metadata_isession\" and ('{HostName:label}' == '*' or (orig_hostname == ('{HostName:label}')))\r\n| summarize obytes = sum(todouble(orig_ip_bytes)), rbytes = sum(todouble(resp_ip_bytes))\r\n| order by obytes desc\r\n| extend MB=((obytes/1024)/1024)\r\n| extend Megabytes=round(MB,2)\r\n| facet by Megabytes",
                    "size": 4,
                    "showAnalytics": true,
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "gridSettings": {
                      "sortBy": [
                        {
                          "itemKey": "count_Megabytes",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "count_Megabytes",
                        "sortOrder": 2
                      }
                    ],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "lightBlue",
                              "text": "Total Outbound Traffic"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "Megabytes",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 38,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": true,
                      "size": "full"
                    }
                  },
                  "customWidth": "25",
                  "name": "Total Outbound Traffic"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type==\"metadata_isession\" and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n| summarize obytes = sum(todouble(orig_ip_bytes)), rbytes = sum(todouble(resp_ip_bytes))\r\n| order by rbytes desc\r\n| extend MB=((rbytes/1024)/1024)\r\n| extend Megabytes=round(MB,2)\r\n| facet by Megabytes",
                    "size": 4,
                    "showAnalytics": true,
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "lightBlue",
                              "text": "Total Inbound traffic"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "Megabytes",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 38,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": true,
                      "size": "full"
                    }
                  },
                  "customWidth": "25",
                  "name": "Total Inbound traffic"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type==\"metadata_isession\" and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n|summarize count()",
                    "size": 4,
                    "showAnalytics": true,
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "lightBlue",
                              "text": "Number of sessions"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": true,
                      "size": "full"
                    }
                  },
                  "customWidth": "25",
                  "name": "Number of sessions"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n|where metadata_type==\"metadata_dns\" and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n|summarize count()",
                    "size": 4,
                    "showAnalytics": true,
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "lightBlue",
                              "text": "Total DNS sessions"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": true,
                      "size": "full"
                    }
                  },
                  "customWidth": "25",
                  "name": "Total DNS sessions"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type==\"metadata_httpsessioninfo\" and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n|summarize count()",
                    "size": 4,
                    "showAnalytics": true,
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "lightBlue",
                              "text": "Total HTTP Sessions"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": true,
                      "size": "full"
                    }
                  },
                  "customWidth": "33.33",
                  "name": "Total HTTP Sessions"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type==\"metadata_ssl\" and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n|summarize count()",
                    "size": 4,
                    "showAnalytics": true,
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "lightBlue",
                              "text": "Total SSL sessions"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": true,
                      "size": "full"
                    }
                  },
                  "customWidth": "33.33",
                  "name": "Total SSL sessions"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type==\"metadata_kerberos_txn\" and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n|extend orig_host_observed_privilege= iff(isempty(toint(orig_host_observed_privilege)), \"Not Available\", tostring(toint(orig_host_observed_privilege)))\r\n|extend privilege = case((toint(orig_host_observed_privilege)>=0 and toint(orig_host_observed_privilege)<=3), \"Low\",\r\n(toint(orig_host_observed_privilege)>=4 and toint(orig_host_observed_privilege)<=6), \"Medium\",\r\n(toint(orig_host_observed_privilege)>=10 and toint(orig_host_observed_privilege)<=10), \"High\",\"Unknown\")\r\n|project  orig_host_observed_privilege, privilege  \r\n|sort by orig_host_observed_privilege  asc  \r\n|limit 1     \r\n\r\n",
                    "size": 4,
                    "showAnalytics": true,
                    "noDataMessage": "Host Privilege - The query returned no results.",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "lightBlue",
                              "text": "Host Privilege"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "orig_host_observed_privilege",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal"
                          },
                          "emptyValCustomText": "0"
                        },
                        "tooltipFormat": {
                          "tooltip": "Host Privilege"
                        }
                      },
                      "showBorder": true,
                      "size": "full"
                    }
                  },
                  "customWidth": "33.33",
                  "name": "Host Privilege"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type==\"metadata_isession\" and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n| summarize count() by service\r\n",
                    "size": 4,
                    "showAnnotations": true,
                    "showAnalytics": true,
                    "title": "Top Services",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "Hello",
                    "exportParameterName": "setTab",
                    "exportDefaultValue": "Hello it's a Demo",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "piechart",
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "alertId_d",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "chartSettings": {
                      "createOtherGroup": 10,
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 0,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "showPin": false,
                  "name": "Top Services",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type==\"metadata_isession\" and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n|extend resp_megabytes=((todouble(resp_ip_bytes)/1024)/1024) \r\n|summarize sum(resp_megabytes) by service",
                    "size": 4,
                    "showAnnotations": true,
                    "showAnalytics": true,
                    "title": "Top Services by Inbound traffic volume",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "Hello",
                    "exportParameterName": "setTab",
                    "exportDefaultValue": "Hello it's a Demo",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "piechart",
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "alertId_d",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "chartSettings": {
                      "createOtherGroup": 10
                    }
                  },
                  "showPin": false,
                  "name": "Top Services by Inbound traffic volume",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type==\"metadata_isession\" and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n| extend orig_megabytes=((todouble(orig_ip_bytes)/1024)/1024)\r\n| summarize sum(orig_megabytes) by service",
                    "size": 4,
                    "showAnnotations": true,
                    "showAnalytics": true,
                    "title": "Top Services by outbound traffic volume",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "Hello",
                    "exportParameterName": "setTab",
                    "exportDefaultValue": "Hello it's a Demo",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "piechart",
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "alertId_d",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "chartSettings": {
                      "createOtherGroup": 10
                    }
                  },
                  "showPin": false,
                  "name": "Top Services by outbound traffic volume",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type==\"metadata_isession\" and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n|summarize Count=count() by  (trim(@\"\\.0\",tostring(id_resp_p)))\r\n|top 15 by Count desc\r\n",
                    "size": 4,
                    "showAnnotations": true,
                    "showAnalytics": true,
                    "title": "Top Responder Ports",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "Hello",
                    "exportParameterName": "setTab",
                    "exportDefaultValue": "Hello it's a Demo",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "piechart",
                    "sortBy": [],
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "alertId_d",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "chartSettings": {
                      "createOtherGroup": 15
                    }
                  },
                  "showPin": false,
                  "name": "Top Responder Ports",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n| where metadata_type == \"metadata_dns\"\r\nand ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\nand id_resp_p  == \"53\"  \r\n|summarize Count=count() by qtype_name\r\n|top 10 by Count desc\r\n",
                    "size": 4,
                    "showAnalytics": true,
                    "title": "DNS Query types",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "fhgjhkj",
                    "exportParameterName": "fgjhkjlk",
                    "exportDefaultValue": "fhgjhkj",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "piechart",
                    "chartSettings": {
                      "createOtherGroup": 15
                    }
                  },
                  "name": "DNS Query types",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n|summarize Count=count() by metadata_type,bin(TimeGenerated, {TimeSpan})\r\n|render barchart \r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Metadata type over time",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "hgbjk",
                    "exportParameterName": "fghkjn",
                    "exportDefaultValue": "ghkjlk",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "barchart",
                    "graphSettings": {
                      "type": 0
                    },
                    "chartSettings": {
                      "yAxis": [
                        "Count"
                      ],
                      "createOtherGroup": 20
                    }
                  },
                  "name": "Metadata type over time",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "VectraStream_function \r\n| where metadata_type == \"metadata_isession\" \r\nand ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n|summarize inbound =  sum(todouble(resp_ip_bytes)),outbound = sum(todouble(orig_ip_bytes)) by  groupBin =bin(TimeGenerated, {TimeSpan})\r\n|render barchart",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "Volume of traffic over time (in bytes)",
                          "timeContextFromParameter": "TimeRange",
                          "exportFieldName": "gghkjlk",
                          "exportParameterName": "jhknjm",
                          "exportDefaultValue": "hjhknm",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "barchart"
                        },
                        "name": "Volume of traffic over time (in bytes)",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "VectraStream_function \r\n|where metadata_type==\"metadata_dns\" \r\n    and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n    and id_resp_p ==\"53\"\r\n| extend dns_answers=answers\r\n| extend orig_hostname= iff(isempty(orig_hostname), \"Not Available\", orig_hostname), resp_hostname= iff(isempty(resp_hostname), \"Not Available\", resp_hostname)\r\n| summarize  [\"Total Queries\"] = count() by query, orig_hostname,qtype_name,total_replies, dns_answers\r\n| order by [\"Total Queries\"]  desc\r\n| project orig_hostname,query,qtype_name, total_replies, dns_answers,[\"Total Queries\"]",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "DNS Table (Most Popular)",
                          "timeContextFromParameter": "TimeRange",
                          "exportFieldName": "ghjk",
                          "exportParameterName": "ghjbnl",
                          "exportDefaultValue": "ghbjnkm",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Total Queries",
                                "formatter": 3,
                                "formatOptions": {
                                  "palette": "blue"
                                }
                              }
                            ],
                            "rowLimit": 10000,
                            "filter": true
                          },
                          "sortBy": []
                        },
                        "name": "DNS Table (Most Popular)",
                        "styleSettings": {
                          "showBorder": true
                        }
                      }
                    ]
                  },
                  "name": "group - 17"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "VectraStream_function \r\n| where metadata_type == \"metadata_isession\" \r\n    and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n    and (local_orig==true and local_resp==false)\r\n| extend resp_hostname= iff(isempty(resp_hostname), \"Not Available\", resp_hostname),orig_hostname = iff(isempty(orig_hostname), \"Not Available\", orig_hostname)\r\n| extend MB=((todouble(orig_ip_bytes)/1024)/1024)\r\n| extend Megabytes=round(MB,2)\r\n|project uid, orig_hostname, id_orig_h, id_resp_h, Megabytes  \r\n| top 50 by Megabytes desc",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "Top Outbound Data Flows in MBytes (Originated from this host)",
                          "timeContextFromParameter": "TimeRange",
                          "exportFieldName": "ghbjnkm",
                          "exportParameterName": "vhbjhn",
                          "exportDefaultValue": "jnkmk,l",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Megabytes",
                                "formatter": 1
                              }
                            ],
                            "rowLimit": 10000,
                            "filter": true
                          },
                          "sortBy": []
                        },
                        "customWidth": "50",
                        "name": "Top Outbound Data Flows in MBytes (Originated from this host)",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": " VectraStream_function\r\n| where metadata_type == \"metadata_isession\" \r\n        and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n                and (local_orig==true and local_resp==false)\r\n                | extend resp_hostname= iff(isempty(resp_hostname), \"Not Available\", resp_hostname),orig_hostname= iff(isempty(orig_hostname), \"Not Available\", orig_hostname)\r\n                | extend MB=((todouble(resp_ip_bytes)/1024)/1024)\r\n                | extend Megabytes=round(MB,2)\r\n                |project uid, orig_hostname, id_orig_h, id_resp_h, Megabytes  \r\n                | top 50 by Megabytes desc\r\n ",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "Top Inbound Data Flows in MBytes (Originated from this host)",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Megabytes",
                                "formatter": 1
                              }
                            ],
                            "rowLimit": 10000,
                            "filter": true
                          },
                          "sortBy": []
                        },
                        "customWidth": "50",
                        "name": "Top Inbound Data Flows in MBytes (Originated from this host)",
                        "styleSettings": {
                          "showBorder": true
                        }
                      }
                    ]
                  },
                  "name": "group - 17 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n|where metadata_type==\"metadata_isession\" and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n and (local_orig==\"true\" and local_resp==\"true\")\r\n| extend orig_hostname= iff(isempty(orig_hostname), \"Not Available\", orig_hostname), resp_hostname= iff(isempty(resp_hostname), \"Not Available\", resp_hostname)\r\n| extend MB=((todouble(resp_ip_bytes)/1024)/1024)\r\n| extend Megabytes=round(MB,2)\r\n| project uid, orig_hostname, id_orig_h, resp_hostname, id_resp_h, Megabytes  \r\n| top 50 by Megabytes desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Top Internal Data Flow in Mbytes (outbound)",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Megabytes",
                          "formatter": 1
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "customWidth": "50",
                  "name": "Top Internal Data Flow in Mbytes (outbound)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type==\"metadata_isession\" and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n  and (local_orig==\"true\" and local_resp==\"true\")\r\n| extend orig_hostname= iff(isempty(orig_hostname), \"Not Available\", orig_hostname), resp_hostname= iff(isempty(resp_hostname), \"Not Available\", resp_hostname)\r\n| extend MB=((todouble(orig_ip_bytes)/1024)/1024) \r\n| extend Megabytes=round(MB,2)\r\n| project uid, orig_hostname, id_orig_h, resp_hostname, id_resp_h, Megabytes  \r\n| top 50 by Megabytes desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Top Internal Data Flow in Mbytes (inbound)",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Megabytes",
                          "formatter": 1
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "Megabytes",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "Megabytes",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "Top Internal Data Flow in Mbytes (inbound)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n| where metadata_type == \"metadata_isession\" \r\n        and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n                and conn_state == \"SF\"\r\n| extend resp_hostname= iff(isempty(resp_hostname), \"Not Available\", resp_hostname),orig_hostname= iff(isempty(orig_hostname), \"Not Available\", orig_hostname),service= iff(isempty(service), \"Not Available\", service),conn_state= iff(isempty(conn_state), \"Not Available\", conn_state)\r\n| summarize id_orig_h = tostring(make_set(id_orig_h)),id_resp_h = tostring(make_set(id_resp_h)),Protocols = tostring(make_set(protoName)), orig_hostname = tostring(make_set(orig_hostname)),resp_domain = tostring(make_set(resp_domain)) by uid,service,id_resp_p,resp_hostname,duration\r\n|order by duration desc\r\n| extend  min_calc=(todouble(duration)/60000)  \r\n| extend  Minutes=round(min_calc,0)\r\n| limit 20\r\n| extend resp_domain= iff(isempty(resp_domain), \"Not Available\", resp_domain)\r\n|project uid, id_orig_h, orig_hostname, id_resp_h, resp_hostname,resp_domain, service, id_resp_p, Minutes",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Long live sessions",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "Minutes",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "Minutes",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "name": "Long live sessions",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type==\"metadata_dcerpc\" and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n  | extend orig_hostname = iff(isempty(orig_hostname), \"Not Available\", orig_hostname), resp_hostname = iff(isempty(resp_hostname), \"Not Available\", resp_hostname)\r\n| project  TimeGenerated ,uid, id_orig_h, orig_hostname, id_resp_h, resp_hostname, id_resp_p,domain, username, endpoint, hostname, operation\r\n|order by TimeGenerated desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "DCE-RPC Table",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "hostname",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "hostname",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "name": "DCE-RPC Table",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n| where metadata_type == \"metadata_ntlm\" \r\n        and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n| extend orig_hostname= iff(isempty(orig_hostname), \"Not Available\", orig_hostname), resp_hostname= iff(isempty(resp_hostname), \"Not Available\", resp_hostname)\r\n| project TimeGenerated ,uid, id_orig_h,orig_hostname,id_resp_h, resp_hostname, id_resp_p, domain, hostname, username, success\r\n|order by TimeGenerated desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "NTLM Table",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "success",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "false",
                                "representation": "failed",
                                "text": "False"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "True"
                              }
                            ]
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "orig_hostname",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "orig_hostname",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "name": "NTLM Table",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n| where metadata_type == \"metadata_kerberos_txn\" \r\n        and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n| extend orig_hostname= iff(isempty(orig_hostname), \"Not Available\", orig_hostname), resp_hostname= iff(isempty(resp_hostname), \"Not Available\", resp_hostname)\r\n| project  TimeGenerated ,uid, id_orig_h,orig_hostname,id_resp_h, resp_hostname, id_resp_p, client,request_type,service, success\r\n|order by TimeGenerated desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Kerberos Table",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "success",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "true",
                                "representation": "success",
                                "text": "True"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "false",
                                "representation": "4",
                                "text": "False"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Blank",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "name": "Kerberos Table",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n| where metadata_type == \"metadata_ntlm\" \r\n        and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n| extend orig_hostname= iff(isempty(orig_hostname), \"Not Available\", orig_hostname), resp_hostname= iff(isempty(resp_hostname), \"Not Available\", resp_hostname)\r\n| project TimeGenerated ,uid, id_orig_h,orig_hostname,id_resp_h, resp_hostname, id_resp_p, domain, hostname, username, success\r\n|order by TimeGenerated desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "NTLM Table",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "success",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "true",
                                "representation": "success",
                                "text": "True"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "false",
                                "representation": "4",
                                "text": "False"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Blank",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "name": "NTLM Table",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n| where metadata_type == \"metadata_ldap\" \r\n        and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}'))) \r\n| extend orig_hostname= iff(isempty(orig_hostname), \"Not Available\", orig_hostname), resp_hostname= iff(isempty(resp_hostname), \"Not Available\", resp_hostname)\r\n| project TimeGenerated ,uid, id_orig_h,orig_hostname,id_resp_h, resp_hostname, id_resp_p, query,query_scope,result,result_count,result_code\r\n|order by TimeGenerated desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "LDAP Table",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "success_b",
                          "formatter": 1
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    }
                  },
                  "name": "LDAP Table",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n| where metadata_type == \"metadata_smbfiles\" \r\n        and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n| extend orig_hostname= iff(isempty(orig_hostname), \"Not Available\", orig_hostname), resp_hostname= iff(isempty(resp_hostname), \"Not Available\", resp_hostname)\r\n| summarize arg_max(TimeGenerated, *) by name\r\n| project TimeGenerated ,id_orig_h, orig_hostname, id_resp_h, resp_hostname, id_resp_p, version, path, action, name\r\n|order by TimeGenerated desc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "SMB Files (Unique Names)",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true
                    }
                  },
                  "name": "SMB Files (Unique Names)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n| where metadata_type == \"metadata_httpsessioninfo\" \r\n        and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n| extend orig_hostname= iff(isempty(orig_hostname), \"Not Available\", orig_hostname)\r\n| extend body_mb=((todouble(resp_ip_bytes)/1024)/1024) \r\n| extend Resp_MB=round(body_mb,2)\r\n|project-rename [\"host_header\"]=host\r\n| project  TimeGenerated ,uid, id_orig_h, orig_hostname, user_agent,id_resp_h, id_resp_p, method, [\"host_header\"],status_code, uri, resp_mime_types,Resp_MB\r\n|order by TimeGenerated desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "HTTP Table",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Resp_MB",
                          "formatter": 1
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    }
                  },
                  "name": "HTTP Table",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_ssl\" and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n| extend resp_hostname= iff(isempty(resp_hostname), \"Not Available\", resp_hostname), resp_domain= iff(isempty(resp_domain), \"Not Available\", resp_domain), server_name= iff(isempty(server_name), \"Not Available\", server_name)\r\n| project TimeGenerated, uid, id_orig_h,orig_hostname, id_resp_h, resp_hostname,id_resp_p, server_name, client_version,next_protocol, cipher,ja3,ja3s\r\n|order by TimeGenerated desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "SSL Table",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true
                    }
                  },
                  "name": "SSL Table",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n| where metadata_type == \"metadata_x509\" \r\n        and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n| extend orig_hostname = iff(isempty(orig_hostname), \"Not Available\", orig_hostname)\r\n| extend expiration_time=unixtime_milliseconds_todatetime(todouble(certificate_not_valid_after))\r\n| project orig_hostname, san_dns, certificate_cn, certificate_subject,certificate_issuer, certificate_self_issued, certificate_key_alg, certificate_key_type, certificate_key_length,expiration_time",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Certificates Table",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "certificate_self_issued",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "true",
                                "representation": "success",
                                "text": "True"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "false",
                                "representation": "4",
                                "text": "False"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Blank",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    }
                  },
                  "name": "Certificates Table",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_rdp\" \r\n        and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n| extend resp_hostname= iff(isempty(resp_hostname), \"Not Available\", resp_hostname), orig_hostname= iff(isempty(orig_hostname), \"Not Available\", orig_hostname),client_build=iff(isnotempty(client_build), client_build, client_build)\r\n| project  TimeGenerated,uid, orig_hostname, id_orig_h, resp_hostname, id_resp_h, id_resp_p, cookie, keyboard_layout, client_build, result\r\n|order by TimeGenerated desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "RDP Table",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true
                    }
                  },
                  "name": "RDP Table",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n| where metadata_type == \"metadata_ssh\" \r\n        and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n| extend resp_hostname= iff(isempty(resp_hostname), \"Not Available\", resp_hostname), orig_hostname= iff(isempty(orig_hostname), \"Not Available\", orig_hostname)\r\n| project uid, orig_hostname, id_orig_h, resp_hostname, id_resp_h, id_resp_p, version, client, server, hassh, hasshServer\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Table SSH",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true
                    }
                  },
                  "name": "Table SSH",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_smtp\" \r\n        and ('{HostName:label}' == '*' or (orig_hostname == tostring('{HostName:label}')))\r\n| extend resp_hostname= iff(isempty(resp_hostname), \"Not Available\", resp_hostname), orig_hostname= iff(isempty(orig_hostname), \"Not Available\", orig_hostname), useragent= iff(isempty(useragent), \"Not Available\", useragent), from= iff(isempty(from), \"Not Available\", from),to_msg = iff(isempty(to_msg), \"Not Available\", to_msg), mail_from = iff(isempty(mail_from), \"Not Available\", mail_from), rcpt_to= iff(isempty(rcpt_to), \"Not Available\", rcpt_to), cc = iff(isempty(cc), \"Not Available\", cc)\r\n| project uid, date, orig_hostname, id_orig_h, resp_hostname, id_resp_h, id_resp_p, tls_b,mail_from, rcpt_to, from, to_msg, cc, subject, useragent",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "SMTP Table",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "tls_b",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "true",
                                "representation": "success",
                                "text": "True"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "false",
                                "representation": "failed",
                                "text": "False"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Blank",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "date",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "date",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "name": "SMTP Table",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "📝 Refresh the web page to fetch details of recently collected events"
                  },
                  "name": "text - 49"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "setTab",
              "comparison": "isEqualTo",
              "value": "Host"
            },
            "name": "Host"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# DNS"
                  },
                  "name": "text - 0"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "aaaf635e-6584-4b26-8e5e-39b2bd15aaf3",
                        "version": "KqlParameterItem/1.0",
                        "name": "Timer",
                        "type": 4,
                        "isRequired": true,
                        "value": {
                          "durationMs": 3600000
                        },
                        "typeSettings": {
                          "selectableValues": [
                            {
                              "durationMs": 300000
                            },
                            {
                              "durationMs": 900000
                            },
                            {
                              "durationMs": 1800000
                            },
                            {
                              "durationMs": 3600000
                            },
                            {
                              "durationMs": 14400000
                            },
                            {
                              "durationMs": 43200000
                            },
                            {
                              "durationMs": 86400000
                            },
                            {
                              "durationMs": 172800000
                            },
                            {
                              "durationMs": 259200000
                            },
                            {
                              "durationMs": 604800000
                            },
                            {
                              "durationMs": 1209600000
                            },
                            {
                              "durationMs": 2419200000
                            },
                            {
                              "durationMs": 2592000000
                            },
                            {
                              "durationMs": 5184000000
                            },
                            {
                              "durationMs": 7776000000
                            }
                          ],
                          "allowCustom": true
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "Timer"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "6b54f87d-034c-43ed-8f11-f76287e8f0c5",
                        "version": "KqlParameterItem/1.0",
                        "name": "SoueceHostName",
                        "label": "Source hostname",
                        "type": 1,
                        "isRequired": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "value": "*"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "SoueceHostName"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "50828f96-546f-42b5-bf84-8ba32c8ccbd9",
                        "version": "KqlParameterItem/1.0",
                        "name": "SourceIp",
                        "label": "Source IP",
                        "type": 1,
                        "isRequired": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "value": "*"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "SourceIp"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "86e66d6f-2bb0-4f50-a8a9-b2ee4061c081",
                        "version": "KqlParameterItem/1.0",
                        "name": "DestinationIP",
                        "label": "Destination IP",
                        "type": 1,
                        "isRequired": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "value": "*"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "DestinationIP"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "fcb0271b-9291-4bd0-a044-01e8129425a9",
                        "version": "KqlParameterItem/1.0",
                        "name": "TimeSpan",
                        "type": 2,
                        "value": "1h",
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "jsonData": "[\r\n    {\"label\": \"1 Hour\", \"value\": \"1h\"},\r\n    {\"label\": \"6 Hour\", \"value\": \"6h\"},\r\n    {\"label\": \"12 Hour\", \"value\": \"12h\"},\r\n    {\"label\": \"1 Day\", \"value\": \"24h\"}\r\n]",
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "label": "Time span"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "TimeSpan"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "029098eb-2e08-45dd-a3a0-c6d3f931ffc5",
                        "version": "KqlParameterItem/1.0",
                        "name": "QueryType",
                        "label": "Query Type",
                        "type": 2,
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "VectraStream_function\r\n| where metadata_type== \"metadata_dns\"\r\n| summarize arg_max(TimeGenerated, *) by qtype_name\r\n|project qtype_name",
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "selectAllValue": "*",
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "Timer",
                        "defaultValue": "value::all",
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "QueryType"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "a88334ed-77a9-4801-b26c-28ae7973753e",
                        "version": "KqlParameterItem/1.0",
                        "name": "SearchKeyWord",
                        "label": "Search keyword",
                        "type": 1,
                        "isRequired": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "value": "*"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "SearchKeyWord"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<br />"
                  },
                  "name": "text - 9"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n| where metadata_type == \"metadata_dns\"\r\n\t\tand ('{SoueceHostName:label}' == '*' or (orig_hostname == tostring('{SoueceHostName:label}')))\r\n        and ('{SourceIp:label}' == '*' or (id_orig_h == tostring('{SourceIp:label}')))\r\n\t\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n        and ('*' in ({QueryType}) or qtype_name in ({QueryType}))\r\n        and id_resp_p ==53\r\n|summarize Requests=count() by orig_hostname,bin(TimeGenerated, {TimeSpan})\r\n|render areachart \r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Top 10 clients by volume of requests",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "areachart",
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "orig_hostname_s",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "Requests",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "graphSettings": {
                      "type": 0,
                      "topContent": {
                        "columnMatch": "orig_hostname_s",
                        "formatter": 1
                      },
                      "centerContent": {
                        "columnMatch": "Requests",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "chartSettings": {
                      "yAxis": [
                        "Requests"
                      ],
                      "createOtherGroup": 10
                    }
                  },
                  "name": "Top 10 clients by volume of requests",
                  "styleSettings": {
                    "margin": "2px",
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n|where metadata_type == \"metadata_dns\"\r\n       and ('{SoueceHostName:label}' == '*' or (orig_hostname == tostring('{SoueceHostName:label}')))\r\n        and ('{SourceIp:label}' == '*' or (id_orig_h == tostring('{SourceIp:label}')))\r\n\t\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n        and ('*' in ({QueryType}) or qtype_name in ({QueryType}))\r\n| summarize Count=count() by qtype_name, groupBin = bin(TimeGenerated, {TimeSpan})\r\n| render areachart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "DNS Queries by type over time",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "areachart",
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "alertId_d",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "chartSettings": {
                      "yAxis": [
                        "Count"
                      ]
                    }
                  },
                  "name": "DNS Queries by type over time",
                  "styleSettings": {
                    "margin": "2px",
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n|where metadata_type == \"metadata_dns\"\r\n        and ('{SoueceHostName:label}' == '*' or (orig_hostname == tostring('{SoueceHostName:label}')))\r\n        and ('{SourceIp:label}' == '*' or (id_orig_h == tostring('{SourceIp:label}')))\r\n\t\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n\t\tand ('*' in ({QueryType}) or qtype_name in ({QueryType}))\r\n        and id_resp_p == \"53\"\r\n|summarize Count=count() by qtype_name\r\n|order by qtype_name desc\r\n",
                    "size": 4,
                    "showAnalytics": true,
                    "title": "Top Query Types",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "piechart",
                    "chartSettings": {
                      "createOtherGroup": 10
                    }
                  },
                  "name": "Top Query Type",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_dns\" \r\n        and ('{SoueceHostName:label}' == '*' or (orig_hostname == tostring('{SoueceHostName:label}')))\r\n        and ('{SourceIp:label}' == '*' or (id_orig_h == tostring('{SourceIp:label}')))\r\n\t\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n\t\tand ('*' in ({QueryType}) or qtype_name in ({QueryType}))\r\n        and id_resp_p == \"53\"\r\n| extend resp_hostname = iff(isempty(resp_hostname), \"Not Available\", resp_hostname)\r\n| extend orig_hostname = iff(isempty(orig_hostname), \"Not Available\", orig_hostname)\r\n| summarize Count=count() by orig_hostname, id_orig_h\r\n| sort by Count desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Top Originators by Count",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Count",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "rowLimit": 10000
                    },
                    "sortBy": [],
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "alertId_d",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "Top Originators by Count",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_dns\" \r\n        and ('{SoueceHostName:label}' == '*' or (orig_hostname == tostring('{SoueceHostName:label}')))\r\n        and ('{SourceIp:label}' == '*' or (id_orig_h == tostring('{SourceIp:label}')))\r\n\t\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n\t\tand ('*' in ({QueryType}) or qtype_name in ({QueryType}))\r\n        and id_resp_p == \"53\"\r\n        and rcode_name == \"NXDomain\"\r\n        and qtype_name != \"PTR\"\r\n//| make-series count() on TimeGenerated in range (ago(30d),now(),2d) by query\r\n|summarize Count=count() by query\r\n|order by Count desc\r\n|limit 10",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Top 10 Queries by Count to Non-Existent Domains",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Count",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "rowLimit": 10000
                    },
                    "sortBy": []
                  },
                  "customWidth": "50",
                  "name": "Top 10 Queries by Count to Non-Existent Domains",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_dns\" \r\n        and ('{SoueceHostName:label}' == '*' or (orig_hostname == tostring('{SoueceHostName:label}')))\r\n        and ('{SourceIp:label}' == '*' or (id_orig_h == tostring('{SourceIp:label}')))\r\n\t\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n\t\tand ('*' in ({QueryType}) or qtype_name in ({QueryType}))\r\n| mv-expand todynamic(query) \r\n| extend querylength=strlen(query)\r\n| summarize count() by querylength, orig_hostname\r\n| order by querylength, count_ desc\r\n| project orig_hostname, querylength, count_\r\n| limit 500",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Query length by Host",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "scatterchart"
                  },
                  "name": "Query Length By Host",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where metadata_type == \"metadata_dns\"\r\n    and ('{SoueceHostName:label}' == '*' or (orig_hostname == tostring('{SoueceHostName:label}')))\r\n        and ('{SourceIp:label}' == '*' or (id_orig_h == tostring('{SourceIp:label}')))\r\n\t\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n\t\tand ('*' in ({QueryType}) or qtype_name in ({QueryType}))\r\n| extend resp_hostname = iff(isempty(resp_hostname), \"Not Available\", resp_hostname), orig_hostname = iff(isempty(orig_hostname), \"Not Available\", orig_hostname)\r\n|project-rename [\"dns_answers\"]=answers\r\n| project TimeGenerated, uid, id_orig_h,orig_hostname, id_resp_h, resp_hostname, id_resp_p, qtype_name, query, [\"dns_answers\"],total_answers,rejected\r\n|order by TimeGenerated desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "DNS Table",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "total_answers_d",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "rejected_b",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "true",
                                "representation": "success",
                                "text": "True"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "false",
                                "representation": "failed",
                                "text": "False"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Blank",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "alertId_d",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "100",
                  "name": "DNS Table",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "📝 Refresh the web page to fetch details of recently collected events"
                  },
                  "name": "text - 20"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "setTab",
              "comparison": "isEqualTo",
              "value": "DNS"
            },
            "name": "DNS"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# SSL/x509"
                  },
                  "name": "text - 22"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "4755513f-9d62-48de-a2cd-5adb78495f53",
                        "version": "KqlParameterItem/1.0",
                        "name": "Timer",
                        "label": "Time Range",
                        "type": 4,
                        "isRequired": true,
                        "typeSettings": {
                          "selectableValues": [
                            {
                              "durationMs": 300000
                            },
                            {
                              "durationMs": 900000
                            },
                            {
                              "durationMs": 1800000
                            },
                            {
                              "durationMs": 3600000
                            },
                            {
                              "durationMs": 14400000
                            },
                            {
                              "durationMs": 43200000
                            },
                            {
                              "durationMs": 86400000
                            },
                            {
                              "durationMs": 172800000
                            },
                            {
                              "durationMs": 259200000
                            },
                            {
                              "durationMs": 604800000
                            },
                            {
                              "durationMs": 1209600000
                            },
                            {
                              "durationMs": 2419200000
                            },
                            {
                              "durationMs": 2592000000
                            },
                            {
                              "durationMs": 5184000000
                            },
                            {
                              "durationMs": 7776000000
                            }
                          ],
                          "allowCustom": true
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "value": {
                          "durationMs": 3600000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "Timer"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "d3a4111b-f265-49d2-b968-81c803fac8ba",
                        "version": "KqlParameterItem/1.0",
                        "name": "SourceHostname",
                        "label": "Source hostname",
                        "type": 1,
                        "isRequired": true,
                        "value": "*",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "SourceHostname"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "6deb3c63-6bf5-43d6-bb48-ac23d3433359",
                        "version": "KqlParameterItem/1.0",
                        "name": "SourceIP",
                        "label": "Source IP",
                        "type": 1,
                        "isRequired": true,
                        "value": "*",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "SourceIP"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "9de88876-b43b-4429-8536-28f972756311",
                        "version": "KqlParameterItem/1.0",
                        "name": "DestinationIP",
                        "label": "Destination IP",
                        "type": 1,
                        "isRequired": true,
                        "value": "*",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "DestinationIP"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "91662e03-e1b3-4319-8209-ff8ec5cedd95",
                        "version": "KqlParameterItem/1.0",
                        "name": "Destinationport",
                        "label": "Destination port",
                        "type": 1,
                        "isRequired": true,
                        "value": "*",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "Destinationport"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "b21e67c2-fff0-49e9-8f03-dad19579ae79",
                        "version": "KqlParameterItem/1.0",
                        "name": "TimeSpan",
                        "type": 2,
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"1h\", \"label\":\"1 hour\", \"selected\":true  },\r\n    { \"value\":\"12h\", \"label\":\"12 hour\" },\r\n    { \"value\":\"24h\", \"label\":\"1 day\"}\r\n]",
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "label": "Time span"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "TimeSpan"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "fa288eef-d220-4317-95c5-b9b8daeb0bee",
                        "version": "KqlParameterItem/1.0",
                        "name": "SearchKeyWord",
                        "label": "search keyword",
                        "type": 1,
                        "isRequired": true,
                        "value": "*",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "SearchKeyWord"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<br />"
                  },
                  "name": "text - 8"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type ==\"metadata_ssl\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n\tand ('{Destinationport:label}' == '*' or (id_resp_p == ('{Destinationport:label}')))\r\n\tand ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n|summarize Count=count() by cipher\r\n|top 10 by Count desc\r\n",
                    "size": 4,
                    "showAnalytics": true,
                    "title": "Top ciphers",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "piechart",
                    "chartSettings": {
                      "createOtherGroup": 10
                    }
                  },
                  "name": "Top ciphers",
                  "styleSettings": {
                    "margin": "2px",
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type ==\"metadata_ssl\" \r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n\tand ('{Destinationport:label}' == '*' or (id_resp_p == ('{Destinationport:label}')))\r\n\tand ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}')) and isnotempty(version)\r\n|summarize Count=count() by version\r\n|top 10 by Count desc\r\n",
                    "size": 4,
                    "showAnalytics": true,
                    "title": "Top TLS versions",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "piechart",
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "alertId_d",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "chartSettings": {
                      "createOtherGroup": 10
                    }
                  },
                  "name": "Top TLS versions",
                  "styleSettings": {
                    "margin": "2px",
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type ==\"metadata_ssl\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n\tand ('{Destinationport:label}' == '*' or (id_resp_p == ('{Destinationport:label}')))\r\n\tand ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n|summarize Count=count() by trim(@\"\\.0\",tostring(id_resp_p))\r\n|top 10 by Count desc",
                    "size": 4,
                    "showAnalytics": true,
                    "title": "Top Destination ports",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "piechart",
                    "gridSettings": {
                      "sortBy": [
                        {
                          "itemKey": "id_resp_p_d",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "id_resp_p_d",
                        "sortOrder": 1
                      }
                    ],
                    "tileSettings": {
                      "showBorder": false
                    },
                    "chartSettings": {
                      "createOtherGroup": 10
                    }
                  },
                  "name": "Top Destination ports",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type ==\"metadata_ssl\" \r\nand ('{SourceHostname:label}' == '*' or (orig_hostname has tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h has tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h has tostring('{DestinationIP:label}')))\r\n\tand ('{Destinationport:label}' == '*' or (id_resp_p == ('{Destinationport:label}')))\r\n\tand ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n| extend orig_hostname= iff(isempty(orig_hostname), \"Not Available\", orig_hostname)\r\n|summarize count() by orig_hostname\r\n| top 10 by count_",
                    "size": 4,
                    "showAnalytics": true,
                    "title": "Top Source hosts (local)",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "piechart",
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "alertId_d",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "chartSettings": {
                      "createOtherGroup": 10
                    }
                  },
                  "name": "Top Source hosts (local)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type ==\"metadata_ssl\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n\tand ('{Destinationport:label}' == '*' or (id_resp_p == ('{Destinationport:label}')))\r\n\tand ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n|summarize count() by  groupBin =bin(TimeGenerated, {TimeSpan})\r\n|render barchart\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "TLS sessions over time",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "barchart"
                  },
                  "name": "TLS sessions over time",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type ==\"metadata_ssl\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n\tand ('{Destinationport:label}' == '*' or (id_resp_p== ('{Destinationport:label}')))\r\n\tand ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n|summarize count() by orig_hostname,groupBin =bin(TimeGenerated, {TimeSpan})\r\n| render barchart\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "TLS sessions over time per hostname",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "barchart",
                    "chartSettings": {
                      "createOtherGroup": 10
                    }
                  },
                  "name": "TLS sessions over time per hostname limit removed",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type ==\"metadata_ssl\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n\tand ('{Destinationport:label}' == '*' or (id_resp_p == ('{Destinationport:label}')))\r\n\tand ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}')) and isnotempty(server_name)\r\n|summarize Count=count() by server_name\r\n|top 10 by Count desc",
                    "size": 4,
                    "showAnalytics": true,
                    "title": "Top SNIs",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "piechart",
                    "chartSettings": {
                      "createOtherGroup": 10
                    }
                  },
                  "name": "Top SNIs",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n|where metadata_type ==\"metadata_ssl\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n        and ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and ('{Destinationport:label}' == '*' or (id_resp_p == ('{Destinationport:label}')))\r\n        and ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}')) and isnotempty(server_name) and isnotempty(ja3) and isnotempty(ja3s)\r\n|summarize Count=count()by server_name, ja3, ja3s\r\n|sort by Count desc\r\n|limit 10",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Top SNIs (Details)",
                    "timeContextFromParameter": "Timer",
                    "exportedParameters": [
                      {
                        "parameterName": "TopSNIs",
                        "parameterType": 1,
                        "defaultValue": "*"
                      },
                      {
                        "parameterName": "linesnidetails",
                        "parameterType": 1,
                        "defaultValue": "*"
                      }
                    ],
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Count",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_bar_Count_3",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_bar_Count_3",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "name": "Top SNIs (Details)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "💡 Click on a row in the above grid to view more details"
                  },
                  "name": "text - 25"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<hr style=\"border-top: 1.25px dotted red;background-color:#fff;\">"
                  },
                  "conditionalVisibility": {
                    "parameterName": "linesnidetails",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "text - 26"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n| where  metadata_type ==\"metadata_ssl\" and ja3 == todynamic('{TopSNIs}')[\"ja3\"]\r\n|project server_name, ja3, ja3s\r\n\r\n",
                    "size": 0,
                    "title": "Top SNIs (Details) DrillDown",
                    "timeContextFromParameter": "Timer",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "TopSNIs",
                    "comparison": "isNotEqualTo",
                    "value": "*"
                  },
                  "name": "query - 24",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n|where metadata_type ==\"metadata_ssl\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n\tand ('{Destinationport:label}' == '*' or (id_resp_p == ('{Destinationport:label}')))\r\n\tand ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n|summarize Count=count()by cipher\r\n|order by Count asc\r\n|top 10 by Count",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Rare ciphers",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Count",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_bar_Count_1",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_bar_Count_1",
                        "sortOrder": 1
                      }
                    ],
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "alertId_d",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "Rare ciphers",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type ==\"metadata_ssl\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n\tand ('{Destinationport:label}' == '*' or (id_resp_p == ('{Destinationport:label}')))\r\n\tand ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n|summarize Count=count()by ja3\r\n|order by Count asc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Rare JA3s",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": [],
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "alertId_d",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "Rare JA3s",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let AddMember = (\r\nVectraStream_function \r\n|where metadata_type ==\"metadata_ssl\" \r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n\tand ('{Destinationport:label}' == '*' or (id_resp_p == ('{Destinationport:label}')))\r\n\tand ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n| extend orig_hostname= iff(isempty(orig_hostname), \"Not Available\", orig_hostname), \r\nserver_name= iff(isempty(server_name), \"Not Available\", server_name)\r\n|summarize count()by ja3\r\n|top 30 by count_\r\n|project ja3);\r\nVectraStream_function\r\n|where metadata_type ==\"metadata_ssl\" and ja3 in (AddMember)\r\n| summarize   Hostname=tostring(make_set(orig_hostname)),[\"Server Name (SNI)\"] = tostring(make_set(server_name)),Count = count() by ja3\r\n|  order by Count asc\r\n|project-rename [\"Total Seen\"]=Count",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Rare JA3s (Details)",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": [],
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "alertId_d",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "name": "Rare JA3s (Details)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n|where metadata_type ==\"metadata_x509\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n\tand ('{Destinationport:label}' == '*' or (id_resp_p == ('{Destinationport:label}')))\r\n\tand ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n    and not (id_resp_p == 443 or id_resp_p == 993 or id_resp_p == 995 or id_resp_p == 465 or id_resp_p == 9001)\r\n|project-rename [\"Certificate Serial\"]=certificate_serial\r\n|summarize [\"Certificate Issuer\"] = make_set(certificate_issuer), [\"Responder Port\"] = make_set(id_resp_p), [\"Certificate CN\"] = make_set(certificate_cn), [\"Responder Host\"] = make_set(id_resp_h),count(certificate_cn)  by [\"Certificate Serial\"]",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "SSL on non standard ports",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": [],
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "alertId_d",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "name": "SSL on non standard ports",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type ==\"metadata_x509\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n\tand ('{Destinationport:label}' == '*' or (id_resp_p == ('{Destinationport:label}')))\r\n\tand ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n|extend orig_hostname = iff(isempty(orig_hostname), \"Not Available\", orig_hostname)\r\n|extend expiration_time = format_datetime((unixtime_seconds_todatetime(tolong(certificate_not_valid_after)/1000)),'MM/dd/yy HH:mm:ss')\r\n|summarize arg_max(TimeGenerated, *) by certificate_cn\r\n|project-rename [\"SAN dns\"]=san_dns,[\"Certificate CN\"]=certificate_cn,[\"Certificate Subject\"]=certificate_subject,[\"Certificate Issuer\"]=certificate_issuer,[\"Self-signed\"]=certificate_self_issued,[\"Key alg\"]=certificate_key_alg,[\"Key type\"]=certificate_key_type,[\"Key Length\"]=certificate_key_length,[\"Expiration date\"]=expiration_time\r\n|project orig_hostname, [\"SAN dns\"], [\"Certificate CN\"], [\"Certificate Subject\"],[\"Certificate Issuer\"], [\"Self-signed\"], [\"Key alg\"], [\"Key type\"], [\"Key Length\"],[\"Expiration date\"]\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Certificates",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "alertId_d",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "name": "Certificates",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type ==\"metadata_ssl\" \r\n     and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n        and ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and ('{Destinationport:label}' == '*' or (id_resp_p == ('{Destinationport:label}')))\r\n        and ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n| extend server_name= iff(isempty(server_name), \"Not Available\", server_name),resp_hostname= iff(isempty(resp_hostname), \"Not Available\", resp_hostname)\r\n|project TimeGenerated, uid, id_orig_h,orig_hostname, id_resp_h, resp_hostname, id_resp_p, server_name,client_version, next_protocol,cipher,ja3,ja3s\r\n|order by TimeGenerated desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "SSL Table",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "TenantId",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "alertId_d",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "name": "SSL Table",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "📝 Refresh the web page to fetch details of recently collected events"
                  },
                  "name": "text - 23"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "setTab",
              "comparison": "isEqualTo",
              "value": "SSL"
            },
            "name": "SSL"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# Connection"
                  },
                  "name": "text - 0"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "59cbc4a8-a701-4e64-b1d2-457294802525",
                        "version": "KqlParameterItem/1.0",
                        "name": "Timer",
                        "label": "Time Range",
                        "type": 4,
                        "isRequired": true,
                        "value": {
                          "durationMs": 3600000
                        },
                        "typeSettings": {
                          "selectableValues": [
                            {
                              "durationMs": 300000
                            },
                            {
                              "durationMs": 900000
                            },
                            {
                              "durationMs": 1800000
                            },
                            {
                              "durationMs": 3600000
                            },
                            {
                              "durationMs": 14400000
                            },
                            {
                              "durationMs": 43200000
                            },
                            {
                              "durationMs": 86400000
                            },
                            {
                              "durationMs": 172800000
                            },
                            {
                              "durationMs": 259200000
                            },
                            {
                              "durationMs": 604800000
                            },
                            {
                              "durationMs": 1209600000
                            },
                            {
                              "durationMs": 2419200000
                            },
                            {
                              "durationMs": 2592000000
                            },
                            {
                              "durationMs": 5184000000
                            },
                            {
                              "durationMs": 7776000000
                            }
                          ],
                          "allowCustom": true
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "Timer"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "164c8e9b-180e-4612-9905-de2f26b255fd",
                        "version": "KqlParameterItem/1.0",
                        "name": "SourceHostname",
                        "label": "Source hostname",
                        "type": 1,
                        "isRequired": true,
                        "timeContext": {
                          "durationMs": 2592000000
                        },
                        "defaultValue": "value::all",
                        "value": "*"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "SourceHostname"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "dcdf3996-7f16-41e4-943b-cfba842922ca",
                        "version": "KqlParameterItem/1.0",
                        "name": "SourceIP",
                        "label": "Source IP",
                        "type": 1,
                        "isRequired": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "value": "*"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "SourceIP"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "bd9f9e25-56e0-4415-a7c9-b8cb5d199f40",
                        "version": "KqlParameterItem/1.0",
                        "name": "DestinationIP",
                        "label": "Destination IP",
                        "type": 1,
                        "isRequired": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "value": "*"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "DestinationIP"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "0e2b8d1c-835a-4843-9b89-03e0a269d3b0",
                        "version": "KqlParameterItem/1.0",
                        "name": "DestinationPort",
                        "label": "Destination port",
                        "type": 1,
                        "isRequired": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "value": "*"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "DestinationPort"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "780884a0-27b1-46e3-aee2-f2bda25284df",
                        "version": "KqlParameterItem/1.0",
                        "name": "Services",
                        "label": "Service",
                        "type": 2,
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "VectraStream_function \r\n|where isnotempty(service) and metadata_type==\"metadata_isession\"\r\n|summarize arg_max(TimeGenerated, *) by service\r\n|project service",
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "selectAllValue": "*",
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "Timer",
                        "defaultValue": "value::all",
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "Services"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "7ba5544a-8352-439b-8f45-a458cbe349b4",
                        "version": "KqlParameterItem/1.0",
                        "name": "TimeSpan",
                        "type": 2,
                        "value": "1h",
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "jsonData": "[\r\n    {\"lable\": \"1 Hour\", \"value\": \"1h\"},\r\n    {\"lable\": \"6 Hour\", \"value\": \"6h\"},\r\n    {\"lable\": \"12 Hour\", \"value\": \"12h\"},\r\n    {\"lable\": \"1 Day\", \"value\": \"24h\"}\r\n]",
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "label": "Time span"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "TimeSpan"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "ce745ac1-b16e-4d64-8c52-0186b7db260c",
                        "version": "KqlParameterItem/1.0",
                        "name": "SearchKeyWord",
                        "label": "search keyword",
                        "type": 1,
                        "isRequired": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "value": "*"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "0",
                  "name": "SearchKeyWord"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<br />"
                  },
                  "name": "text - 19"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n|where metadata_type == \"metadata_isession\"\r\n   and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n\tand ('{DestinationPort:label}' == '*' or (id_resp_p == ('{DestinationPort:label}')))\r\n\tand ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n\tand ('*' in ({Services}) or service in ({Services}))\r\n|summarize Count=count()by service\r\n|top 10 by Count desc",
                    "size": 4,
                    "showAnalytics": true,
                    "title": "Top Services by count",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "piechart",
                    "chartSettings": {
                      "createOtherGroup": 10
                    }
                  },
                  "name": "Top Services by count",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type == \"metadata_isession\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n\tand ('{DestinationPort:label}' == '*' or (id_resp_p == ('{DestinationPort:label}')))\r\n\tand ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n\tand ('*' in ({Services}) or service in ({Services}))\r\n|summarize Count=count() by trim(@\"\\.0\",tostring(id_resp_p))\r\n|top 10 by Count desc\r\n",
                    "size": 4,
                    "showAnalytics": true,
                    "title": "Top Responder Ports by count",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "piechart",
                    "gridSettings": {
                      "sortBy": [
                        {
                          "itemKey": "id_resp_p_d",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "id_resp_p_d",
                        "sortOrder": 1
                      }
                    ],
                    "chartSettings": {
                      "createOtherGroup": 10
                    }
                  },
                  "name": "Top Responder Ports by count",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type == \"metadata_isession\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n\tand ('{DestinationPort:label}' == '*' or (id_resp_p == ('{DestinationPort:label}')))\r\n\tand ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n\tand ('*' in ({Services}) or service in ({Services}))\r\n|extend orig_hostname = iff(isempty(orig_hostname), \"Not Available\", orig_hostname)\r\n|summarize Count=count() by orig_hostname\r\n|top 10 by Count desc",
                    "size": 4,
                    "showAnalytics": true,
                    "title": "Top Originators (sources) by # of connections",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "piechart",
                    "chartSettings": {
                      "createOtherGroup": 10
                    }
                  },
                  "name": "Top Originators (sources) by # of connections",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type == \"metadata_isession\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n\tand ('{DestinationPort:label}' == '*' or (id_resp_p == ('{DestinationPort:label}')))\r\n\tand ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n\tand ('*' in ({Services}) or service in ({Services}))\r\n|summarize Count=count() by id_resp_h\r\n|top 10 by Count desc\r\n",
                    "size": 4,
                    "showAnalytics": true,
                    "title": "Top Responders (destinations) by # of connections",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "piechart",
                    "chartSettings": {
                      "createOtherGroup": 10
                    }
                  },
                  "name": "Top Responders (destinations) by # of connections",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function\r\n|where metadata_type == \"metadata_isession\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n\tand ('{DestinationPort:label}' == '*' or (id_resp_p == ('{DestinationPort:label}')))\r\n\tand ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n\tand ('*' in ({Services}) or service in ({Services}))\r\n|extend orig_hostname = iff(isempty(orig_hostname), \"Not Available\", orig_hostname),resp_hostname= iff(isempty(resp_hostname), \"Not Available\", resp_hostname)\r\n|summarize Count = count() by orig_hostname,groupBin =bin(TimeGenerated, {TimeSpan})\r\n|render barchart\r\n\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Connection events (Top host)",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "barchart",
                    "gridSettings": {
                      "sortBy": [
                        {
                          "itemKey": "Count",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "Count",
                        "sortOrder": 2
                      }
                    ],
                    "chartSettings": {
                      "createOtherGroup": null
                    }
                  },
                  "name": "Connection events (Top host)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type == \"metadata_isession\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n\tand ('{DestinationPort:label}' == '*' or (id_resp_p == ('{DestinationPort:label}')))\r\n\tand ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n\tand ('*' in ({Services}) or service in ({Services})) and isnotempty(orig_hostname)\r\n|extend orig_megabytes=((todouble(orig_ip_bytes)/1024)/1024) \r\n|extend resp_megabytes=((todouble(resp_ip_bytes)/1024)/1024) \r\n|extend MB_in=round(resp_megabytes,2) \r\n|extend MB_out=round(orig_megabytes,2) \r\n|extend Total=MB_in+MB_out\r\n|extend orig_hostname = iff(isempty(orig_hostname), \"Not Available\", orig_hostname)\r\n|summarize [\"Inbound Volume\"]=sum(MB_in), [\"Outbound Volume\"]=sum(MB_out), [\"Total Volume\"]=sum(Total) by orig_hostname,service\r\n|top 50 by [\"Total Volume\"] desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Volume of traffic per service by Origin Host (in Mb)",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "areachart",
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "orig_hostname_s",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "Inbound Volume",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "graphSettings": {
                      "type": 0,
                      "topContent": {
                        "columnMatch": "orig_hostname_s",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "orig_hostname_s"
                      },
                      "centerContent": {
                        "columnMatch": "Inbound Volume",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "nodeIdField": "orig_hostname_s",
                      "sourceIdField": "orig_hostname_s",
                      "targetIdField": "Inbound Volume",
                      "graphOrientation": 3,
                      "showOrientationToggles": false,
                      "nodeSize": null,
                      "staticNodeSize": 100,
                      "colorSettings": null,
                      "hivesMargin": 5
                    },
                    "chartSettings": {
                      "xAxis": "orig_hostname",
                      "yAxis": [
                        "Outbound Volume",
                        "Inbound Volume",
                        "Total Volume",
                        "orig_hostname",
                        "service"
                      ]
                    },
                    "mapSettings": {
                      "locInfo": "LatLong",
                      "sizeSettings": "Inbound Volume",
                      "sizeAggregation": "Sum",
                      "legendMetric": "Inbound Volume",
                      "legendAggregation": "Sum",
                      "itemColorSettings": {
                        "type": "heatmap",
                        "colorAggregation": "Sum",
                        "nodeColorField": "Inbound Volume",
                        "heatmapPalette": "greenRed"
                      }
                    }
                  },
                  "name": "Volume of traffic per service by Origin Host (in Mb)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type == \"metadata_isession\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n        and ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and ('{DestinationPort:label}' == '*' or (id_resp_p == ('{DestinationPort:label}')))\r\n        and ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n        and ('*' in ({Services}) or service in ({Services}))\r\n        and (local_orig==true and local_resp==false)\r\n| extend orig_hostname= iff(isempty(orig_hostname), \"Not Available\", orig_hostname)\r\n|summarize Protocols = tostring(make_set(protoName)), obytes = sum(todouble(orig_ip_bytes)), rbytes=sum(todouble(resp_ip_bytes)) by id_orig_h, orig_hostname, id_resp_h, uid\r\n|top 50 by obytes desc\r\n|extend MB = ((obytes/1024)/1024) \r\n|extend Megabytes=round(MB,2)\r\n|project uid, orig_hostname, id_orig_h, id_resp_h, Megabytes, Protocols",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Top Outbound Data Flows in MBytes (Originated from internal hosts)",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Megabytes",
                          "formatter": 1
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "Protocols",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "Protocols",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "name": "Top Outbound Data Flows in MBytes (Originated from internal hosts)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type == \"metadata_isession\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n        and ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and ('{DestinationPort:label}' == '*' or (id_resp_p == ('{DestinationPort:label}')))\r\n        and ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n        and ('*' in ({Services}) or service in ({Services}))\r\n        and (local_orig==true and local_resp==false)\r\n| extend orig_hostname= iff(isempty(orig_hostname), \"Not Available\", orig_hostname)\r\n|summarize Protocols = tostring(make_set(protoName)), obytes = sum(todouble(orig_ip_bytes)), rbytes=sum(todouble(resp_ip_bytes)) by id_orig_h, orig_hostname, id_resp_h, uid\r\n|top 50 by rbytes desc\r\n|extend MB = ((rbytes/1024)/1024) \r\n|extend Megabytes=round(MB,2)\r\n|project uid, orig_hostname, id_orig_h, id_resp_h, Megabytes, Protocols",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Top Inbound Data Flows in MBytes (Originated from internal hosts)",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Megabytes",
                          "formatter": 1
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "name": "Top Inbound Data Flows in MBytes (Originated from internal hosts)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "VectraStream_function \r\n|where metadata_type == \"metadata_isession\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n\tand ('{DestinationPort:label}' == '*' or (id_resp_p == ('{DestinationPort:label}')))\r\n\tand ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n\tand ('*' in ({Services}) or service in ({Services}))\r\n\tand (local_orig ==\"true\" and local_resp == \"true\") and isnotempty(resp_hostname)\r\n|extend orig_hostname = iff(isempty(orig_hostname), \"Not Available\", orig_hostname)\r\n|summarize Protocols = tostring(make_set(protoName)), obytes = sum(todouble(orig_ip_bytes)), rbytes=sum(todouble(resp_ip_bytes)) by id_orig_h, orig_hostname, resp_hostname, id_resp_h, uid\r\n|order by obytes desc\r\n|limit 50\r\n|extend MB = ((obytes/1024)/1024) \r\n|extend Megabytes=round(MB,2)\r\n|project uid, orig_hostname, id_orig_h, resp_hostname, id_resp_h, Megabytes, Protocols\r\n",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "Top Internal Data Flow in Mbytes (Outbound)",
                          "timeContextFromParameter": "Timer",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Megabytes",
                                "formatter": 1
                              }
                            ],
                            "rowLimit": 10000,
                            "filter": true
                          },
                          "sortBy": []
                        },
                        "customWidth": "50",
                        "name": "Top Internal Data Flow in Mbytes (Outbound)",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "VectraStream_function \r\n|where metadata_type == \"metadata_isession\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n\tand ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n\tand ('{DestinationPort:label}' == '*' or (id_resp_p == ('{DestinationPort:label}')))\r\n\tand ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n\tand ('*' in ({Services}) or service in ({Services}))\r\n\tand (local_orig ==\"true\" and local_resp == \"true\") and isnotempty(resp_hostname)\r\n|extend orig_hostname = iff(isempty(orig_hostname), \"Not Available\", orig_hostname)\r\n|summarize Protocols = tostring(make_set(protoName)), obytes = sum(todouble(orig_ip_bytes)), rbytes=sum(todouble(resp_ip_bytes)) by id_orig_h, orig_hostname, resp_hostname, id_resp_h, uid\r\n|top 50 by rbytes desc\r\n|extend MB = ((rbytes/1024)/1024) \r\n|extend Megabytes=round(MB,2)\r\n|project uid, orig_hostname, id_orig_h,resp_hostname, id_resp_h,  Megabytes, Protocols",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "Top Internal Data Flow in Mbytes (Inbound)",
                          "timeContextFromParameter": "Timer",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Megabytes",
                                "formatter": 1
                              }
                            ],
                            "rowLimit": 10000,
                            "filter": true
                          },
                          "sortBy": []
                        },
                        "customWidth": "50",
                        "name": "Top Internal Data Flow in Mbytes (Inbound)",
                        "styleSettings": {
                          "showBorder": true
                        }
                      }
                    ]
                  },
                  "name": "group - 20"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraStream_function \r\n|where metadata_type == \"metadata_isession\"\r\n    and ('{SourceHostname:label}' == '*' or (orig_hostname == tostring('{SourceHostname:label}')))\r\n    and ('{SourceIP:label}' == '*' or (id_orig_h == tostring('{SourceIP:label}')))\r\n        and ('{DestinationIP:label}' == '*' or (id_resp_h == tostring('{DestinationIP:label}')))\r\n        and ('{DestinationPort:label}' == '*' or (id_resp_p == ('{DestinationPort:label}')))\r\n        and ('{SearchKeyWord:label}' == '*' or (* has '{SearchKeyWord:label}'))\r\n        and ('*' in ({Services}) or service in ({Services}))\r\n| extend orig_hostname= iff(isempty(orig_hostname), \"Not Available\", orig_hostname),resp_hostname= iff(isempty(resp_hostname), \"Not Available\", resp_hostname),conntate= iff(isempty(conn_state), \"Not Available\", conn_state),service= iff(isempty(service), \"Not Available\", service)\r\n| summarize id_orig_h = tostring(make_set(id_orig_h)),id_resp_h = tostring(make_set(id_resp_h)),Protocols = tostring(make_set(protoName)), orig_hostname = tostring(make_set(orig_hostname)),resp_domain = tostring(make_set(resp_domain)) by uid,service,duration\r\n| extend  min_calc=(todouble(duration)/60000)   \r\n| extend  Minutes=round(min_calc,0) \r\n|top 20 by duration desc\r\n| extend resp_domain= iff(isempty(resp_domain), \"Not Available\", resp_domain)\r\n|project uid, id_orig_h, orig_hostname, id_resp_h, resp_domain, service, Minutes\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Open/Active Long Lived Connections",
                    "timeContextFromParameter": "Timer",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "Minutes",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "Minutes",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "customWidth": "100",
                  "name": "Open/Active Long Lived Connections",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "📝 Refresh the web page to fetch details of recently collected events"
                  },
                  "name": "text - 20"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "setTab",
              "comparison": "isEqualTo",
              "value": "Connection"
            },
            "name": "Connection"
          }
        ]
      },
      "name": "Main",
      "styleSettings": {
        "showBorder": true
      }
    }
  ],
  "fromTemplateId": "sentinel-AIVectraStream",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
